<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Painel de Operações - Pizzattolog</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&amp;display=swap" rel="stylesheet">
  <style>
   * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
body {
  font-family: 'Open Sans', sans-serif;
  background: url('https://i.postimg.cc/FzJfb8Yz/fundo.png') no-repeat center center fixed;
  background-size: cover;
  padding-top: 100px;
  color: #222;
  backdrop-filter: blur(2px); /* suaviza fundo */
}

main {
  max-width: 1000px;
  margin: 100px auto 40px auto;
  background: rgba(255, 255, 255, 0.96);
  border-radius: 16px;
  padding: 40px;
  box-shadow: 0 12px 32px rgba(0,0,0,0.2);
}

nav {
    display: flex;
    background: rgba(0,0,0,0.8);
    color: white;
  }
  nav button {
    flex: 1;
    padding: 12px;
    background: transparent;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    color: white;
    transition: background 0.3s ease;
  }
  nav button.ativo, nav button:hover {
    background: #0d6efd;
  }
  .aba {
    display: none;
  }
  .aba.ativa {
    display: block;
  }

 /* GALERIA DIÁLOGOS */
  #galeriaDialogos {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 16px;
    margin-top: 20px;
  }
  #galeriaDialogos img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.12);
  }
  /* Colaboradores - container grid */
  .colaboradores-container {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    gap: 20px;
    margin-top: 20px;
  }
  .funcionario-card {
    background: rgba(255,255,255,0.95);
    border-radius: 16px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    position: relative;
    transition: 0.3s ease;
  }
  .funcionario-card:hover {
    transform: translateY(-4px);
  }
  .funcionario-foto {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 50%;
    border: 3px solid #0d6efd;
  }
  .funcionario-info {
    display: flex;
    flex-direction: column;
  }
  .funcionario-nome {
    font-size: 18px;
    font-weight: 600;
    color: #333;
  }
  .funcionario-cargo {
    font-size: 15px;
    color: #555;
  }
  .funcionario-turno {
    font-size: 14px;
    color: #888;
  }
  /* Botão excluir no card */
  .btn-excluir {
    position: absolute;
    top: 8px;
    right: 8px;
    background: #dc3545;
    border: none;
    color: white;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    opacity: 0.85;
    transition: opacity 0.2s ease;
  }
  .btn-excluir:hover {
    opacity: 1;
  }
  /* Botão flutuante adicionar */
  #btnAddColaborador {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: #0d6efd;
    color: white;
    border: none;
    border-radius: 50%;
    width: 56px;
    height: 56px;
    font-size: 32px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    z-index: 2000;
  }
     #btnAddColaborador {
    right: 30px;
  }
  #btnAddDialogo {
    right: 100px;
  }
  /* Modal base */
  .modal {
    display: none;
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 3000;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: white;
    padding: 20px;
    border-radius: 12px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  }
  .modal-content h3 {
    margin-bottom: 15px;
  }
  .modal-content input[type="text"],
  .modal-content input[type="password"],
  .modal-content input[type="file"] {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 15px;
  }
  .modal-content button {
    padding: 12px 18px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .modal-content .btn-cancelar {
    background: #6c757d;
    color: white;
    margin-right: 10px;
  }
  .modal-content .btn-cancelar:hover {
    background: #5a6268;
  }
  .modal-content .btn-salvar {
    background: #198754;
    color: white;
  }
  .modal-content .btn-salvar:hover {
    background: #146c43;
  }
  #msgErroSenha {
    color: red;
    display: none;
    margin-top: 10px;
    font-weight: 600;
  }
  /* Filtros */
  #pesquisaNomeColaboradores, #filtroTurnoColaboradores {
    margin-top: 20px;
    padding: 12px;
    width: 100%;
    max-width: 300px;
    font-size: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
   @media (max-width: 768px) {
    .foto-card img {
      height: 180px;
    }
  }
  </style>
</head>
<body>
<nav>
    <button onclick="mostrarAba('operacoes', event)" class="ativo">Formulario</button>
    <button onclick="mostrarAba('colaboradores', event)">Colaboradores</button>
    <button onclick="mostrarAba('dialogos')">Diálogos de Segurança</button>
    <button onclick="mostrarAba('cheklist')">cheklist</button>
    <button onclick="mostrarAba('indicadores')">Indicadores</button>
  </nav>
  
<main>

  <div id="operacoes" class="aba ativa">
    <h2>FORMULÁRIO</h2>
    <form id="formulario-operacoes" name="formulario-operacoes">
           
                <div class="form-grid">
                    <div class="coluna-esquerda">
                        <label for="cte">CTE</label> <input type="text" id="cte" name="cte" required="">
                        <label for="destino_origem">Destino/Origem</label> <input type="text" id="destino_origem" name="destino_origem" required="">
                        <label for="placa">Placa da Carreta</label> <input type="text" id="placa" name="placa" required="">
                        <label for="motorista">Motorista</label> <input type="text" id="motorista" name="motorista" required="">
                        <label for="transportadora">Transportadora</label>
                        <select id="transportadora" name="transportadora" required="" onchange="mostrarOutroCampo(this)">
                            <option value="">Selecione</option>
                            <option value="PIZZATTOLOG">PIZZATTOLOG</option>
                            <option value="SULISTA">SULISTA</option>
                            <option value="WESTROCK">WESTROCK</option>
                            <option value="AXON">AXON</option>
                            <option value="CF LOG TRANS">CF LOG TRANS</option>
                            <option value="ATIVA">ATIVA</option>
                            <option value="BRIX">BRIX</option>
                            <option value="CF LOG">CF LOG</option>
                            <option value="COOPERCARGA">COOPERCARGA</option>
                            <option value="COSTA TEIXEIRA">COSTA TEIXEIRA</option>
                            <option value="DAIFFER LOGISTICA">DAIFFER LOGISTICA</option>
                            <option value="DALFER">DALFER</option>
                            <option value="EAGLE">EAGLE</option>
                            <option value="ESTRELA DO ORIENTE">ESTRELA DO ORIENTE</option>
                            <option value="MCP">MCP</option>
                            <option value="HORIZONTES/BR">HORIZONTES/BR</option>
                            <option value="MODULAR">MODULAR</option>
                            <option value="SOLISTICA">SOLISTICA</option>
                            <option value="TRANSBEM">TRANSBEM</option>
                            <option value="outro">Outros</option>
                        </select>
                        <div id="campoOutro">
                            <label for="outraTransportadora">Digite o nome da Transportadora</label>
                            <input type="text" id="outraTransportadora" name="outraTransportadora" placeholder="Digite aqui...">


                        </div>
                        <label for="pallets">Pallets</label> <input type="number" id="pallets" name="pallets" required="">
                        <label for="carga_descarga">Tipo de Operação</label>
                        <select id="carga_descarga" name="carga_descarga" required="">
                            <option value="">Selecione</option>
                            <option value="carga">Carga</option>
                            <option value="descarga">Descarga</option>
                        </select>
                    </div>
                    <div class="coluna-direita">
                        <label for="agendamento">Agendamento</label> <input type="datetime-local" id="agendamento" name="agendamento" required="">
                        <label for="inicio">Início</label> <input type="datetime-local" id="inicio" name="inicio" required="">
                        <label for="chegada">Chegada</label> <input type="datetime-local" id="chegada" name="chegada" required="">
                        <label for="termino">Término</label> <input type="datetime-local" id="termino" name="termino" required="">
                    </div>
                </div>
                <button type="submit" id="btnEnviar">ENVIAR</button>
      
       </form>
    </div>
   <div id="colaboradores" class="aba">
      <h2>COLABORADORES</h2>
    <input id="pesquisaNomeColaboradores" placeholder="Pesquisar por nome">
     
      <!-- Botão flutuante -->
  <button id="btnAddColaborador" title="Adicionar Colaborador" style="
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: #0d6efd;
    color: white;
    border: none;
    border-radius: 50%;
    width: 56px;
    height: 56px;
    font-size: 32px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    z-index: 2000;
  ">+</button>

  <!-- Modal senha -->
  <div id="modalSenha" style="
    display: none;
    position: fixed; top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
    z-index: 3000;
    display: flex; justify-content: center; align-items: center;
  ">
    <div style="background: white; padding: 20px; border-radius: 8px; max-width: 320px; width: 90%;">
      <h3>Digite a senha para adicionar colaborador</h3>
      <input type="password" id="inputSenha" placeholder="Senha" style="width: 100%; padding: 10px; margin-top: 10px;">
      <div style="margin-top: 15px; text-align: right;">
        <button id="btnCancelarSenha" style="margin-right: 10px;">Cancelar</button>
        <button id="btnConfirmarSenha">Confirmar</button>
      </div>
      <p id="msgErroSenha" style="color: red; display: none; margin-top: 10px;">Senha incorreta</p>
    </div>
  </div>

  <!-- Modal form colaborador -->
  <div id="modalFormColaborador" style="
    display: none;
    position: fixed; top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
    z-index: 3000;
    display: flex; justify-content: center; align-items: center;
  ">
    <form id="formColaboradorModal" style="background: white; padding: 20px; border-radius: 8px; max-width: 400px; width: 90%;">
      <h3>Adicionar Colaborador</h3>
      <input name="nome" placeholder="Nome" required style="width: 100%; margin-bottom: 10px; padding: 10px;">
      <input name="cargo" placeholder="Cargo" required style="width: 100%; margin-bottom: 10px; padding: 10px;">
      <input name="turno" placeholder="Turno" required style="width: 100%; margin-bottom: 10px; padding: 10px;">
      <input name="foto" type="file" accept="image/*" required style="margin-bottom: 15px;">
      <div style="text-align: right;">
        <button type="button" id="btnCancelarForm" style="margin-right: 10px;">Cancelar</button>
        <button type="submit">Salvar</button>
      </div>
    </form>
  </div>
</div>
    <select id="filtroTurnoColaboradores">
      <option value="">Todos os turnos</option>
      <option value="1º Turno">1º Turno</option>
      <option value="2º Turno">2º Turno</option>
      <option value="3º Turno">3º Turno</option>
    </select>
  
  <div id="lista-funcionarios" class="colaboradores-container"></div>
  
   <div id="dialogos" class="aba">
    <h2>Diálogos de Segurança</h2>
   <div class="galeria" id="galeriaDialogos"></div>
  </div>
    <button class="fab" id="btnFlutuante">+</button>

   
    <div id="descricao-content" class="tab-content">
      <h2>Descrição Operacional</h2>
      <p>Conteúdo de descrição operacional.</p>
    </div>
   
    <div id="checklist-content" class="tab-content">
      <h2>CHECK LIST</h2>
      <p>Conteúdo da aba "Check List" em construção...</p>
    </div>

   <div id="indicadores" class="aba">
    <h2>Indicadores</h2>
    <div class="grafico-container">
      <canvas id="graficoTipo"></canvas>
    </div>
  </div>
</main>
  <!-- Modal Senha (único para ambos) -->
<div class="modal" id="modalSenha">
  <div class="modal-content">
    <h3>Digite a senha para continuar</h3>
    <input type="password" id="inputSenha" placeholder="Senha" />
    <div style="text-align:right;">
      <button class="btn-cancelar" id="btnCancelarSenha">Cancelar</button>
      <button class="btn-salvar" id="btnConfirmarSenha">Confirmar</button>
    </div>
    <p id="msgErroSenha">Senha incorreta</p>
  </div>
</div>

<!-- Modal Formulário Colaborador -->
<div class="modal" id="modalFormColaborador">
  <form id="formColaboradorModal" class="modal-content">
    <h3>Adicionar Colaborador</h3>
    <input type="text" name="nome" placeholder="Nome" required />
    <input type="text" name="cargo" placeholder="Cargo" required />
    <input type="text" name="turno" placeholder="Turno" required />
    <input type="file" name="foto" accept="image/png" required />
    <div style="text-align:right;">
      <button type="button" class="btn-cancelar" id="btnCancelarForm">Cancelar</button>
      <button type="submit" class="btn-salvar">Salvar</button>
    </div>
  </form>
</div>

<!-- Modal Formulário Diálogo -->
<div class="modal" id="modalFormDialogo">
  <div class="modal-content">
    <h3>Adicionar Foto de Diálogo</h3>
    <input type="file" id="fotoDialogo" accept="image/*" />
    <div style="text-align:right; margin-top: 15px;">
      <button class="btn-cancelar" id="btnCancelarDialogo">Cancelar</button>
      <button class="btn-salvar" id="btnSalvarDialogo">Salvar</button>
    </div>
  </div>
</div>

<script>
 const supabase = createClient("https://tzdogfvislvfiyepjpid.supabase.co", "processo . env . SUPABASE_KEY");
 const supabase = supabase.createClient(supabaseUrl, supabaseKey);

 const SENHA_UNICA = "1234";

  // Controle da ação atual após senha: 'colaborador' ou 'dialogo'
  let acaoAtual = null;

  // Elementos modais e botões
  const modalSenha = document.getElementById("modalSenha");
  const inputSenha = document.getElementById("inputSenha");
  const msgErroSenha = document.getElementById("msgErroSenha");
  const btnCancelarSenha = document.getElementById("btnCancelarSenha");
  const btnConfirmarSenha = document.getElementById("btnConfirmarSenha");

  const modalFormColaborador = document.getElementById("modalFormColaborador");
  const formColaboradorModal = document.getElementById("formColaboradorModal");
  const btnCancelarForm = document.getElementById("btnCancelarForm");

  const modalFormDialogo = document.getElementById("modalFormDialogo");
  const btnCancelarDialogo = document.getElementById("btnCancelarDialogo");
  const btnSalvarDialogo = document.getElementById("btnSalvarDialogo");
  const fotoDialogoInput = document.getElementById("fotoDialogo");

  const btnAddColaborador = document.getElementById("btnAddColaborador");
  const btnAddDialogo = document.getElementById("btnAddDialogo");

  const listaFuncionarios = document.getElementById("lista-funcionarios");
  const galeriaDialogos = document.getElementById("galeriaDialogos");
  const pesquisaNomeColaboradores = document.getElementById("pesquisaNomeColaboradores");
  const filtroTurnoColaboradores = document.getElementById("filtroTurnoColaboradores");

  // Mostrar aba
  function mostrarAba(id, event) {
    document.querySelectorAll(".aba").forEach(e => e.classList.remove("ativa"));
    document.getElementById(id).classList.add("ativa");
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("ativo"));
    if(event) event.currentTarget.classList.add("ativo");

    btnAddColaborador.style.display = (id === "colaboradores") ? "block" : "none";
    btnAddDialogo.style.display = (id === "dialogos") ? "block" : "none";

    if(id === "colaboradores") carregarColaboradores();
    if(id === "dialogos") carregarDialogos();
  }

  // Carregar colaboradores do Supabase
  async function carregarColaboradores() {
    const { data, error } = await supabase.from("colaboradores").select("*");
    if (error) {
      alert("Erro ao carregar colaboradores: " + error.message);
      return;
    }
    exibirColaboradores(data);
  }

  // Mostrar colaboradores na galeria
  function exibirColaboradores(lista) {
    // Aplica filtros de pesquisa e turno
    const pesquisa = pesquisaNomeColaboradores.value.toLowerCase();
    const turnoFiltro = filtroTurnoColaboradores.value;

    const filtrados = lista.filter(c => {
      const nomeMatch = c.nome.toLowerCase().includes(pesquisa);
      const turnoMatch = turnoFiltro === "" || c.turno === turnoFiltro;
      return nomeMatch && turnoMatch;
    });

    listaFuncionarios.innerHTML = "";

    if (filtrados.length === 0) {
      listaFuncionarios.innerHTML = "<p>Nenhum colaborador encontrado.</p>";
      return;
    }

    filtrados.forEach(c => {
      const card = document.createElement("div");
      card.className = "foto-card";

      const img = document.createElement("img");
      img.src = c.foto;
      img.alt = `Foto de ${c.nome}`;
      card.appendChild(img);

      const legenda = document.createElement("div");
      legenda.className = "foto-legenda";

      const nome = document.createElement("div");
      nome.className = "nome";
      nome.textContent = c.nome;
      legenda.appendChild(nome);

      const cargo = document.createElement("div");
      cargo.textContent = `Cargo: ${c.cargo}`;
      legenda.appendChild(cargo);

      const turno = document.createElement("div");
      turno.textContent = `Turno: ${c.turno}`;
      legenda.appendChild(turno);

      card.appendChild(legenda);

      listaFuncionarios.appendChild(card);
    });
  }

  pesquisaNomeColaboradores.addEventListener("input", () => {
    carregarColaboradores(); // recarrega com filtro
  });
  filtroTurnoColaboradores.addEventListener("change", () => {
    carregarColaboradores(); // recarrega com filtro
  });

  // Carregar diálogos do Supabase
  async function carregarDialogos() {
    const { data, error } = await supabase.from("dialogos").select("*").order('id', { ascending: false });
    if (error) {
      alert("Erro ao carregar diálogos: " + error.message);
      return;
    }
    galeriaDialogos.innerHTML = "";
    if(data.length === 0) {
      galeriaDialogos.innerHTML = "<p>Nenhuma foto de diálogo adicionada.</p>";
      return;
    }
    data.forEach(d => {
      const img = document.createElement("img");
      img.src = d.url;
      img.alt = "Foto de diálogo";
      galeriaDialogos.appendChild(img);
    });
  }

  // Mostrar modal senha
  function abrirModalSenha(acao) {
    acaoAtual = acao; // 'colaborador' ou 'dialogo'
    inputSenha.value = "";
    msgErroSenha.style.display = "none";
    modalSenha.style.display = "flex";
    inputSenha.focus();
  }

  // Fechar modal senha
  function fecharModalSenha() {
    modalSenha.style.display = "none";
    acaoAtual = null;
  }

  // Confirmar senha
  btnConfirmarSenha.onclick = () => {
    const senha = inputSenha.value.trim();
    if(senha === SENHA_UNICA) {
      fecharModalSenha();
      if(acaoAtual === "colaborador") abrirModalColaborador();
      else if(acaoAtual === "dialogo") abrirModalDialogo();
    } else {
      msgErroSenha.style.display = "block";
    }
  }

  btnCancelarSenha.onclick = fecharModalSenha;

  // Abrir modal adicionar colaborador
  function abrirModalColaborador() {
    formColaboradorModal.reset();
    modalFormColaborador.style.display = "flex";
  }
  // Fechar modal colaborador
  btnCancelarForm.onclick = () => {
    modalFormColaborador.style.display = "none";
  }

  // Abrir modal adicionar diálogo
  function abrirModalDialogo() {
    fotoDialogoInput.value = "";
    modalFormDialogo.style.display = "flex";
  }
  // Fechar modal diálogo
  btnCancelarDialogo.onclick = () => {
    modalFormDialogo.style.display = "none";
  }

  // Enviar colaborador para Supabase
  formColaboradorModal.onsubmit = async (e) => {
    e.preventDefault();
    const nome = e.target.nome.value.trim();
    const cargo = e.target.cargo.value.trim();
    const turno = e.target.turno.value.trim();
    const fotoFile = e.target.foto.files[0];

    if(!nome || !cargo || !turno || !fotoFile) {
      alert("Preencha todos os campos!");
      return;
    }

    // Upload da foto para storage
    const fileExt = fotoFile.name.split('.').pop();
    const fileName = `${Date.now()}.${fileExt}`;
    const filePath = `colaboradores/${fileName}`;

    let { error: uploadError } = await supabase.storage
      .from('imagens')
      .upload(filePath, fotoFile);

    if(uploadError) {
      alert("Erro ao enviar foto: " + uploadError.message);
      return;
    }

    // Obter URL público
    const { data: publicUrlData } = supabase.storage
      .from('imagens')
      .getPublicUrl(filePath);

    // Inserir no banco
    const { data, error } = await supabase.from('colaboradores').insert({
      nome, cargo, turno, foto: publicUrlData.publicUrl
    });

    if(error) {
      alert("Erro ao salvar colaborador: " + error.message);
      return;
    }

    modalFormColaborador.style.display = "none";
    carregarColaboradores();
  };

  // Salvar diálogo
  btnSalvarDialogo.onclick = async () => {
    const fotoFile = fotoDialogoInput.files[0];
    if(!fotoFile) {
      alert("Selecione uma foto para enviar!");
      return;
    }

    const fileExt = fotoFile.name.split('.').pop();
    const fileName = `${Date.now()}.${fileExt}`;
    const filePath = `dialogos/${fileName}`;

    let { error: uploadError } = await supabase.storage
      .from('imagens')
      .upload(filePath, fotoFile);

    if(uploadError) {
      alert("Erro ao enviar foto: " + uploadError.message);
      return;
    }

    const { data: publicUrlData } = supabase.storage
      .from('imagens')
      .getPublicUrl(filePath);

    const { data, error } = await supabase.from('dialogos').insert({
      url: publicUrlData.publicUrl
    });

    if(error) {
      alert("Erro ao salvar diálogo: " + error.message);
      return;
    }

    modalFormDialogo.style.display = "none";
    carregarDialogos();
  };

  // Eventos botões flutuantes
  btnAddColaborador.onclick = () => abrirModalSenha("colaborador");
  btnAddDialogo.onclick = () => abrirModalSenha("dialogo");

  // Ao carregar página, abrir aba default
  mostrarAba('operacoes');

  async function gerarIndicadores() {
   const { data } = await supabase.from("formulário").select("carga_descarga");
const carga = data.filter(d => d.carga_descarga === "carga").length;
const descarga = data.filter(d => d.carga_descarga === "descarga").length;
    new Chart(document.getElementById("graficoTipo"), {
      type: 'bar',
      data: {
        labels: ['Carga', 'Descarga'],
        datasets: [{ label: 'Operações', data: [carga, descarga], backgroundColor: ['#4caf50', '#2196f3'] }]
      }
    });
  }
  gerarIndicadores();
</script>
</body>
</html>
